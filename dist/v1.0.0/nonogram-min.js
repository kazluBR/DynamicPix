const SVG_LIB="http://www.w3.org/2000/svg",SQUARE_COLOR_SIZE=40,TRANSLATE_X=10,TRANSLATE_Y=0,LINE_COLOR="#808080",MARK_COLOR="#808080",CALCULATED_EMPTY_COLOR="#808080",RULE_COLOR="#ff00ff",SIGNAL_CORRECT_COLOR="#adff2f",SIGNAL_ERROR_COLOR="#b22222",NUMBER_DEFAULT_COLOR="#ffffff";class nonogram{#size;#data;#totalValidated;#clicked;#states;#currentKey;#squareI;#squareJ;#colorSquare;#colorSelected;#markSelected;constructor(t={}){this.#size=t.size||20,this.#data={},this.#totalValidated=!1,this.#clicked=!1,this.#states=[],this.#currentKey=0,this.#squareI=null,this.#squareJ=null,this.#colorSquare=null,this.#colorSelected=null,this.#markSelected=null,document.body.onmousedown=t=>{if(1==t.button)return this.#switchSquareColor(),!1},document.body.onmouseup=()=>this.#endColorsChange(),this.#createSvgDocument()}init(t){this.#data=t,this.#clean(),this.#changeSvgDocumentSize(),this.#totalValidated=!1,this.#colorSelected=t.colors[1];for(let t=1;t<this.#data.colors.length;t++)this.#createSquareColor(t);let e=this.#data.settings.horizontalNumbersLength*this.#size,i=this.#data.settings.verticalNumbersLength*this.#size;this.#createBackground(e,i);for(let t=0;t<this.#data.settings.width;t++)for(let s=0;s<this.#data.settings.height;s++)this.#createMark(e,i,t,s),this.#createSquare(e,i,t,s),this.#createMarkAux(e,i,t,s),this.#createSquareAux(e,i,t,s);for(let t=0;t<=this.#data.settings.width;t++){if(t<this.#data.settings.width){this.#createSignal(e,i,0,t);for(let s=1;s<=this.#data.verticalNumbers[t].length;s++)this.#createSquareNumber(e,i,0,t,s),this.#createNumber(e,i,0,t,s)}this.#createLine(e,i,0,t)}for(let t=0;t<=this.#data.settings.height;t++){if(t<this.#data.settings.height){this.#createSignal(e,i,1,t);for(let s=1;s<=this.#data.horizontalNumbers[t].length;s++)this.#createSquareNumber(e,i,1,t,s),this.#createNumber(e,i,1,t,s)}this.#createLine(e,i,1,t)}this.#createCalculated(e,i,0),this.#createCalculated(e,i,1),this.#validate(),this.#saveState()}maximize(t){null!=this.#data&&(this.#size+=t||1,this.#changeAreaSize())}minimize(t){null!=this.#data&&(this.#size-=t||1,this.#size<1?this.#size+=t||1:this.#changeAreaSize())}undo(){null!=this.#data&&this.#currentKey>0&&(this.#currentKey-=1,this.#recoverState())}redo(){null!=this.#data&&this.#currentKey<this.#states.length-1&&(this.#currentKey+=1,this.#recoverState())}check(){if(null!=this.#data){var t,e,i,s,r,a,u=0;for(let l=0;l<this.#data.settings.width;l++){r=document.getElementById("signal_0."+l);for(let h=0;h<this.#data.settings.height;h++)e=(t=document.getElementById("square_"+l+"."+h)).getAttribute("fill"),i=t.getAttribute("opacity"),a=document.getElementById("signal_1."+h),e!=this.#data.colors[this.#data.points[h][l]]&&"1"==i?(r.setAttribute("opacity","1"),r.setAttribute("fill","#b22222"),a.setAttribute("opacity","1"),a.setAttribute("fill","#b22222"),u++):(s=document.getElementById("mark_"+l+"."+h).getAttribute("opacity"),0!=this.#data.points[h][l]&&"1"==s&&(r.setAttribute("opacity","1"),r.setAttribute("fill","#b22222"),a.setAttribute("opacity","1"),a.setAttribute("fill","#b22222"),u++))}alert(u+" errors found")}}solve(){var t;if(null!=this.#data)for(let e=0;e<this.#data.settings.height;e++)for(let i=0;i<this.#data.settings.width;i++)(t=document.getElementById("square_"+i+"."+e)).setAttribute("fill",this.#data.colors[this.#data.points[e][i]]),t.setAttribute("opacity","1")}#createSvgDocument(){let t=document.getElementById("nonogram");t.oncontextmenu=function(){return!1};let e=document.createElementNS(SVG_LIB,"svg");e.setAttribute("id","svg");let i="translate(10,0)",s=document.createElementNS(SVG_LIB,"g");s.setAttribute("transform",i),s.setAttribute("id","palette"),e.appendChild(s);i="translate(10,60)";let r=document.createElementNS(SVG_LIB,"g");r.setAttribute("id","main"),r.setAttribute("transform",i),e.appendChild(r);let a=document.createElementNS(SVG_LIB,"g");a.setAttribute("id","components"),a.setAttribute("transform",i),e.appendChild(a);let u=document.createElementNS(SVG_LIB,"g");u.setAttribute("id","aux"),u.setAttribute("transform",i),e.appendChild(u),t.appendChild(e)}#createSquareColor(t){let e=document.createElementNS(SVG_LIB,"rect");e.setAttribute("id","squareColor_"+t),1==t?e.setAttribute("stroke-width","3"):e.setAttribute("stroke-width","1"),e.setAttribute("stroke","black"),e.setAttribute("height",40),e.setAttribute("width",40),e.setAttribute("fill",this.#data.colors[t]),e.setAttribute("x",40*(t-1)+5),e.setAttribute("y",5),e.onclick=t=>this.#markSquareColor(t),document.getElementById("palette").appendChild(e)}#createBackground(t,e){let i=document.createElementNS(SVG_LIB,"rect");i.setAttribute("id","background"),i.setAttribute("fill",this.#data.colors[0]),i.setAttribute("height",this.#size*this.#data.settings.height),i.setAttribute("width",this.#size*this.#data.settings.width),i.setAttribute("x",t),i.setAttribute("y",e),document.getElementById("main").appendChild(i)}#createMark(t,e,i,s){let r=document.createElementNS(SVG_LIB,"text");r.setAttribute("id","mark_"+i+"."+s),r.setAttribute("text-anchor","middle"),r.setAttribute("font-family","serif"),r.setAttribute("font-size",this.#size),r.setAttribute("fill","#808080"),r.setAttribute("x",t+(i+.5)*this.#size),r.setAttribute("y",e+(s+.85)*this.#size),r.setAttribute("opacity","0"),r.textContent="•",document.getElementById("main").appendChild(r)}#createMarkAux(t,e,i,s){let r=document.createElementNS(SVG_LIB,"text");r.setAttribute("id","mark_aux_"+i+"."+s),r.setAttribute("text-anchor","middle"),r.setAttribute("font-family","serif"),r.setAttribute("font-size",this.#size),r.setAttribute("fill","#808080"),r.setAttribute("x",t+(i+.5)*this.#size),r.setAttribute("y",e+(s+.85)*this.#size),r.setAttribute("opacity","0"),r.textContent="•",document.getElementById("aux").appendChild(r)}#createSquare(t,e,i,s){let r=document.createElementNS(SVG_LIB,"rect");r.setAttribute("id","square_"+i+"."+s),r.setAttribute("fill",this.#data.colors[0]),r.setAttribute("opacity","0"),r.setAttribute("height",.9*this.#size),r.setAttribute("width",.9*this.#size),r.setAttribute("x",t+i*this.#size+.05*this.#size),r.setAttribute("y",e+s*this.#size+.05*this.#size),document.getElementById("main").appendChild(r)}#createSquareAux(t,e,i,s){let r=document.createElementNS(SVG_LIB,"rect");r.setAttribute("id","square_aux_"+i+"."+s),r.setAttribute("fill",this.#data.colors[0]),r.setAttribute("opacity","0"),r.setAttribute("height",.9*this.#size),r.setAttribute("width",.9*this.#size),r.setAttribute("x",t+i*this.#size+.05*this.#size),r.setAttribute("y",e+s*this.#size+.05*this.#size),r.onmouseover=t=>this.#highlightSquare(t),r.onmouseout=t=>this.#fadeSquare(t),r.onmousedown=t=>this.#initColorsChange(t),r.onmousemove=t=>this.#changeColorSquares(t),document.getElementById("aux").appendChild(r)}#createSignal(t,e,i,s){let r=document.createElementNS(SVG_LIB,"text");r.setAttribute("id","signal_"+i+"."+s),r.setAttribute("font-size",this.#size),r.setAttribute("opacity","0"),0==i?(r.setAttribute("text-anchor","start"),r.setAttribute("x",t+s*this.#size),r.setAttribute("y",e+(this.#data.settings.height+1)*this.#size),r.textContent="⏶"):(r.setAttribute("text-anchor","end"),r.setAttribute("x",t+(this.#data.settings.width+1)*this.#size),r.setAttribute("y",e+(s+.9)*this.#size),r.textContent="⏴"),document.getElementById("components").appendChild(r)}#createSquareNumber(t,e,i,s,r){let a=document.createElementNS(SVG_LIB,"rect");if(a.setAttribute("id","squareNumber_"+i+"."+s+"."+(r-1)),a.setAttribute("opacity","1"),a.setAttribute("height",this.#size),a.setAttribute("width",this.#size),0==i){a.setAttribute("x",t+s*this.#size),a.setAttribute("y",e-r*this.#size);let i=this.#data.verticalNumbers[s][r-1].color;a.setAttribute("fill",this.#data.colors[i])}else{a.setAttribute("x",t-r*this.#size),a.setAttribute("y",e+s*this.#size);let i=this.#data.horizontalNumbers[s][r-1].color;a.setAttribute("fill",this.#data.colors[i])}a.onclick=t=>this.#markSquareNumber(t),document.getElementById("components").appendChild(a)}#createNumber(t,e,i,s,r){let a=document.createElementNS(SVG_LIB,"text");a.setAttribute("id","number_"+i+"."+s+"."+(r-1)),a.setAttribute("text-anchor","middle"),a.setAttribute("font-family","serif"),a.setAttribute("font-size",.9*this.#size),a.setAttribute("font-weight","normal"),a.setAttribute("fill","#ffffff"),0==i?(a.setAttribute("x",t+s*this.#size+.5*this.#size),a.setAttribute("y",e-r*this.#size+.8*this.#size),a.textContent=this.#data.verticalNumbers[s][r-1].number):(a.setAttribute("x",t-r*this.#size+.5*this.#size),a.setAttribute("y",e+s*this.#size+.8*this.#size),a.textContent=this.#data.horizontalNumbers[s][r-1].number),a.onclick=t=>this.#markNumber(t),document.getElementById("components").appendChild(a)}#createLine(t,e,i,s){let r=document.createElementNS(SVG_LIB,"line");r.setAttribute("id","line_"+i+"."+s),r.setAttribute("stroke","#808080"),s%this.#data.settings.gridLength==0?r.setAttribute("stroke-width","2"):r.setAttribute("stroke-width","1"),0==i?(r.setAttribute("x1",t+s*this.#size),r.setAttribute("x2",t+s*this.#size),r.setAttribute("y1",e-this.#data.settings.verticalNumbersLength*this.#size),r.setAttribute("y2",e+this.#data.settings.height*this.#size)):(r.setAttribute("x1",t-this.#data.settings.horizontalNumbersLength*this.#size),r.setAttribute("x2",t+this.#data.settings.width*this.#size),r.setAttribute("y1",e+s*this.#size),r.setAttribute("y2",e+s*this.#size)),document.getElementById("components").appendChild(r)}#createCalculated(t,e,i){let s=document.createElementNS(SVG_LIB,"text");s.setAttribute("id","calculated_"+i),s.setAttribute("font-family","serif"),s.setAttribute("font-size",this.#size),s.setAttribute("font-weight","bold"),s.setAttribute("fill","#808080"),0==i?(s.setAttribute("text-anchor","start"),s.setAttribute("x",t+(this.#data.settings.width+1)*this.#size+this.#size/4)):(s.setAttribute("text-anchor","middle"),s.setAttribute("y",e+(this.#data.settings.height+1)*this.#size+this.#size)),document.getElementById("components").appendChild(s)}#clean(){let t=document.getElementById("palette");for(;t.firstChild;)t.removeChild(t.firstChild);let e=document.getElementById("components");for(;e.firstChild;)e.removeChild(e.firstChild);let i=document.getElementById("main");for(;i.firstChild;)i.removeChild(i.firstChild);let s=document.getElementById("aux");for(;s.firstChild;)s.removeChild(s.firstChild);this.#states=[]}#changeSvgDocumentSize(){let t=document.getElementById("svg");t.setAttribute("height",this.#size*this.#data.settings.verticalNumbersLength+this.#size*(this.#data.settings.height+3)+0+60),t.setAttribute("width",this.#size*this.#data.settings.horizontalNumbersLength+this.#size*(this.#data.settings.width+3)+10)}#validate(){let t,e,i,s,r,a;this.#totalValidated=!0;for(let u=0;u<this.#data.settings.width;u++){t=!0,s=document.getElementById("signal_0."+u);for(let r=0;r<this.#data.settings.height;r++)if(e=document.getElementById("square_"+u+"."+r),i=e.getAttribute("fill"),i!=this.#data.colors[this.#data.points[r][u]]){t=!1,this.#totalValidated=!1,"1"==s.getAttribute("opacity")&&s.setAttribute("opacity","0");break}if(t){for(let t=0;t<this.#data.verticalNumbers[u].length;t++)r=document.getElementById("squareNumber_0."+u+"."+t),r.setAttribute("opacity","0"),a=document.getElementById("number_0."+u+"."+t),a.setAttribute("fill",r.getAttribute("fill"));"0"!=s.getAttribute("opacity")&&"#b22222"!=s.getAttribute("fill")||(s.setAttribute("fill","#adff2f"),s.setAttribute("opacity","1"))}}for(let u=0;u<this.#data.settings.height;u++){t=!0,s=document.getElementById("signal_1."+u);for(let r=0;r<this.#data.settings.width;r++)if(e=document.getElementById("square_"+r+"."+u),i=e.getAttribute("fill"),i!=this.#data.colors[this.#data.points[u][r]]){t=!1,this.#totalValidated=!1,"1"==s.getAttribute("opacity")&&s.setAttribute("opacity","0");break}if(t){for(let t=0;t<this.#data.horizontalNumbers[u].length;t++)r=document.getElementById("squareNumber_1."+u+"."+t),r.setAttribute("opacity","0"),a=document.getElementById("number_1."+u+"."+t),a.setAttribute("fill",r.getAttribute("fill"));"0"!=s.getAttribute("opacity")&&"#b22222"!=s.getAttribute("fill")||(s.setAttribute("fill","#adff2f"),s.setAttribute("opacity","1"))}}if(this.#totalValidated){let t;for(let e=0;e<this.#data.settings.height;e++)for(let i=0;i<this.#data.settings.width;i++)t=document.getElementById("mark_"+i+"."+e),t.setAttribute("opacity","0");document.getElementById("calculated_0").textContent="",document.getElementById("calculated_1").textContent="",alert("Puzzle Solved!")}}#changeAreaSize(){this.#changeSvgDocumentSize();var t=this.#data.settings.horizontalNumbersLength*this.#size,e=this.#data.settings.verticalNumbersLength*this.#size;this.#changeBackgroundSize(t,e);for(let i=0;i<this.#data.settings.width;i++)for(let s=0;s<this.#data.settings.height;s++)this.#changeMarkSize(t,e,i,s),this.#changeMarkAuxSize(t,e,i,s),this.#changeSquareSize(t,e,i,s),this.#changeSquareAuxSize(t,e,i,s);for(let i=0;i<=this.#data.settings.width;i++){if(i<this.#data.settings.width){this.#changeSignalSize(t,e,0,i);for(let s=1;s<=this.#data.verticalNumbers[i].length;s++)this.#changeSquareNumberSize(t,e,0,i,s),this.#changeNumberSize(t,e,0,i,s)}this.#changeLineSize(t,e,0,i)}for(let i=0;i<=this.#data.settings.height;i++){if(i<this.#data.settings.height){this.#changeSignalSize(t,e,1,i);for(let s=1;s<=this.#data.horizontalNumbers[i].length;s++)this.#changeSquareNumberSize(t,e,1,i,s),this.#changeNumberSize(t,e,1,i,s)}this.#changeLineSize(t,e,1,i)}this.#changeCalculatedSize(t,e,0),this.#changeCalculatedSize(t,e,1)}#changeBackgroundSize(t,e){var i=document.getElementById("background");i.setAttribute("height",this.#size*this.#data.settings.height),i.setAttribute("width",this.#size*this.#data.settings.width),i.setAttribute("x",t),i.setAttribute("y",e)}#changeMarkSize(t,e,i,s){var r=document.getElementById("mark_"+i+"."+s);r.setAttribute("font-size",this.#size),r.setAttribute("x",t+(i+.5)*this.#size),r.setAttribute("y",e+(s+.85)*this.#size)}#changeMarkAuxSize(t,e,i,s){var r=document.getElementById("mark_aux_"+i+"."+s);r.setAttribute("font-size",this.#size),r.setAttribute("x",t+(i+.5)*this.#size),r.setAttribute("y",e+(s+.85)*this.#size)}#changeSquareSize(t,e,i,s){var r=document.getElementById("square_"+i+"."+s);r.setAttribute("height",.9*this.#size),r.setAttribute("width",.9*this.#size),r.setAttribute("x",t+i*this.#size+.05*this.#size),r.setAttribute("y",e+s*this.#size+.05*this.#size)}#changeSquareAuxSize(t,e,i,s){var r=document.getElementById("square_aux_"+i+"."+s);r.setAttribute("height",.9*this.#size),r.setAttribute("width",.9*this.#size),r.setAttribute("x",t+i*this.#size+.05*this.#size),r.setAttribute("y",e+s*this.#size+.05*this.#size)}#changeSignalSize(t,e,i,s){var r=document.getElementById("signal_"+i+"."+s);r.setAttribute("font-size",this.#size),0==i?(r.setAttribute("x",t+s*this.#size),r.setAttribute("y",e+(this.#data.settings.height+1)*this.#size)):(r.setAttribute("x",t+(this.#data.settings.width+1)*this.#size),r.setAttribute("y",e+(s+.9)*this.#size))}#changeNumberSize(t,e,i,s,r){var a=document.getElementById("number_"+i+"."+s+"."+(r-1));a.setAttribute("font-size",.9*this.#size),0==i?(a.setAttribute("x",t+s*this.#size+.5*this.#size),a.setAttribute("y",e-r*this.#size+.8*this.#size)):(a.setAttribute("x",t-r*this.#size+.5*this.#size),a.setAttribute("y",e+s*this.#size+.8*this.#size))}#changeSquareNumberSize(t,e,i,s,r){var a=document.getElementById("squareNumber_"+i+"."+s+"."+(r-1));a.setAttribute("height",this.#size),a.setAttribute("width",this.#size),0==i?(a.setAttribute("x",t+s*this.#size),a.setAttribute("y",e-r*this.#size)):(a.setAttribute("x",t-r*this.#size),a.setAttribute("y",e+s*this.#size))}#changeLineSize(t,e,i,s){var r=document.getElementById("line_"+i+"."+s);0==i?(r.setAttribute("x1",t+s*this.#size),r.setAttribute("x2",t+s*this.#size),r.setAttribute("y1",e-this.#data.settings.verticalNumbersLength*this.#size),r.setAttribute("y2",e+this.#data.settings.height*this.#size)):(r.setAttribute("x1",t-this.#data.settings.horizontalNumbersLength*this.#size),r.setAttribute("x2",t+this.#data.settings.width*this.#size),r.setAttribute("y1",e+s*this.#size),r.setAttribute("y2",e+s*this.#size))}#changeCalculatedSize(t,e,i){var s=document.getElementById("calculated_"+i);s.setAttribute("font-size",this.#size),0==i?s.setAttribute("x",t+(this.#data.settings.width+1)*this.#size+this.#size/4):s.setAttribute("y",e+(this.#data.settings.height+1)*this.#size+this.#size)}#saveState(){for(;this.#currentKey<this.#states.length-1;)this.#states.pop();this.#states.push((new XMLSerializer).serializeToString(document.getElementById("main"))),this.#states.length>1&&(this.#currentKey+=1)}#recoverState(){let t=document.getElementById("main");for(;t.firstChild;)t.removeChild(t.firstChild);let e=(new DOMParser).parseFromString(this.#states[this.#currentKey],"image/svg+xml").documentElement;for(;e.firstChild;)t.appendChild(e.firstChild);this.#validate(),this.#changeAreaSize()}#refreshCalculatedValues(t,e){let i=document.getElementById("square_"+t+"."+e);this.#clicked&&(i=document.getElementById("square_aux_"+t+"."+e));let s,r,a=i.getAttribute("fill"),u=1,l=t+1;for(;l<=this.#data.settings.width-1&&(s=document.getElementById("square_"+l+"."+e),r=document.getElementById("square_aux_"+l+"."+e),s.getAttribute("fill")==a||r.getAttribute("fill")==a&&a!=this.#data.colors[0]);)l++,u++;let h=t-1;for(;h>=0&&(s=document.getElementById("square_"+h+"."+e),r=document.getElementById("square_aux_"+h+"."+e),s.getAttribute("fill")==a||r.getAttribute("fill")==a&&a!=this.#data.colors[0]);)h--,u++;let n=1,o=e+1;for(;o<=this.#data.settings.height-1&&(s=document.getElementById("square_"+t+"."+o),r=document.getElementById("square_aux_"+t+"."+o),s.getAttribute("fill")==a||r.getAttribute("fill")==a&&a!=this.#data.colors[0]);)o++,n++;let d=e-1;for(;d>=0&&(s=document.getElementById("square_"+t+"."+d),r=document.getElementById("square_aux_"+t+"."+d),s.getAttribute("fill")==a||r.getAttribute("fill")==a&&a!=this.#data.colors[0]);)d--,n++;let c=document.getElementById("calculated_0"),g=document.getElementById("calculated_1");a!=this.#data.colors[0]?(c.setAttribute("fill",a),g.setAttribute("fill",a)):(c.setAttribute("fill","#808080"),g.setAttribute("fill","#808080")),c.textContent=u,g.textContent=n;let b=this.#data.settings.verticalNumbersLength*this.#size;c.setAttribute("y",b+this.#size*(e+.9));let m=this.#data.settings.horizontalNumbersLength*this.#size;g.setAttribute("x",m+this.#size*(t+.5))}#cleanAllSquaresAndMarksAux(){let t,e;for(let i=0;i<this.#data.settings.width;i++)for(let s=0;s<this.#data.settings.height;s++)t=document.getElementById("square_aux_"+i+"."+s),"1"==t.getAttribute("opacity")&&(i==this.#squareI&&s==this.#squareJ||(t.setAttribute("fill",this.#data.colors[0]),t.setAttribute("opacity","0"))),e=document.getElementById("mark_aux_"+i+"."+s),"1"==e.getAttribute("opacity")&&(i==this.#squareI&&s==this.#squareJ||e.setAttribute("opacity","0"))}#refreshSquareAndMark(t,e){let i,s,r=document.getElementById("square_aux_"+t+"."+e),a=document.getElementById("square_"+t+"."+e),u=document.getElementById("mark_aux_"+t+"."+e),l=document.getElementById("mark_"+t+"."+e);this.#markSelected?(i=a.getAttribute("fill"),i==this.#data.colors[0]&&u.setAttribute("opacity","1")):this.#colorSquare==this.#data.colors[0]?(r.setAttribute("fill",this.#colorSquare),r.setAttribute("opacity","1"),u.setAttribute("opacity","0.1")):(i=a.getAttribute("fill"),s=l.getAttribute("opacity"),i==this.#data.colors[0]&&"0"==s&&(r.setAttribute("fill",this.#colorSquare),r.setAttribute("opacity","1")))}#markSquareColor(t){let e,i=t.target.getAttribute("id");i=i.replace("squareColor_",""),this.#colorSelected=this.#data.colors[i],t.target.setAttribute("stroke-width","3");for(let t=1;t<this.#data.colors.length;t++)e=document.getElementById("squareColor_"+t),t!=i&&e.setAttribute("stroke-width","1")}#highlightSquare(t){if(!this.#totalValidated){let e=t.target.getAttribute("id");e=e.replace("square_aux_","");let i=e.split("."),s=parseInt(i[0]),r=parseInt(i[1]),a=document.getElementById("line_0."+s);a.setAttribute("stroke","#ff00ff"),s%this.#data.settings.gridLength!=0&&a.setAttribute("stroke-width","2");let u=document.getElementById("line_1."+r);u.setAttribute("stroke","#ff00ff"),r%this.#data.settings.gridLength!=0&&u.setAttribute("stroke-width","2"),s+=1,r+=1,a=document.getElementById("line_0."+s),a.setAttribute("stroke","#ff00ff"),s%this.#data.settings.gridLength!=0&&a.setAttribute("stroke-width","2"),u=document.getElementById("line_1."+r),u.setAttribute("stroke","#ff00ff"),r%this.#data.settings.gridLength!=0&&u.setAttribute("stroke-width","2")}}#fadeSquare(t){if(!this.#totalValidated){let e=t.target.getAttribute("id");e=e.replace("square_aux_","");let i=e.split("."),s=parseInt(i[0]),r=parseInt(i[1]),a=document.getElementById("line_0."+s);a.setAttribute("stroke","#808080"),s%this.#data.settings.gridLength!=0&&a.setAttribute("stroke-width","1");let u=document.getElementById("line_1."+r);u.setAttribute("stroke","#808080"),r%this.#data.settings.gridLength!=0&&u.setAttribute("stroke-width","1"),s+=1,r+=1,a=document.getElementById("line_0."+s),a.setAttribute("stroke","#808080"),s%this.#data.settings.gridLength!=0&&a.setAttribute("stroke-width","1"),u=document.getElementById("line_1."+r),u.setAttribute("stroke","#808080"),r%this.#data.settings.gridLength!=0&&u.setAttribute("stroke-width","1"),document.getElementById("calculated_0").textContent="",document.getElementById("calculated_1").textContent=""}}#initColorsChange(t){if(!this.#totalValidated&&1!=t.button){let e=t.target.getAttribute("id");e=e.replace("square_aux_","");let i=e.split(".");this.#squareI=parseInt(i[0]),this.#squareJ=parseInt(i[1]);let s=document.getElementById("square_"+this.#squareI+"."+this.#squareJ);this.#colorSquare=s.getAttribute("fill");let r=document.getElementById("mark_aux_"+this.#squareI+"."+this.#squareJ),a=document.getElementById("mark_"+this.#squareI+"."+this.#squareJ),u=a.getAttribute("opacity");this.#markSelected=!1,this.#colorSquare==this.#data.colors[0]?"0"==u?0==t.button?(t.target.setAttribute("fill",this.#colorSelected),t.target.setAttribute("opacity","1"),s.setAttribute("fill",this.#colorSelected),s.setAttribute("opacity","1"),this.#colorSquare=this.#colorSelected):(r.setAttribute("opacity","1"),a.setAttribute("opacity","1"),this.#markSelected=!0):(0==t.button&&(t.target.setAttribute("fill",this.#colorSelected),t.target.setAttribute("opacity","1"),s.setAttribute("fill",this.#colorSelected),s.setAttribute("opacity","1"),this.#colorSquare=this.#colorSelected),r.setAttribute("opacity","0.1"),a.setAttribute("opacity","0")):0==t.button?this.#colorSquare!=this.#colorSelected?(t.target.setAttribute("fill",this.#colorSelected),s.setAttribute("fill",this.#colorSelected),this.#colorSquare=this.#colorSelected):(t.target.setAttribute("fill",this.#data.colors[0]),t.target.setAttribute("opacity","0"),s.setAttribute("fill",this.#data.colors[0]),s.setAttribute("opacity","0"),this.#colorSquare=this.#data.colors[0]):(t.target.setAttribute("fill",this.#data.colors[0]),t.target.setAttribute("opacity","0"),s.setAttribute("fill",this.#data.colors[0]),s.setAttribute("opacity","0"),r.setAttribute("opacity","1"),a.setAttribute("opacity","1"),this.#markSelected=!0),this.#clicked=!0,this.#refreshCalculatedValues(this.#squareI,this.#squareJ)}}#changeColorSquares(t){if(!this.#totalValidated){let e=t.target.getAttribute("id");e=e.replace("square_aux_","");let i,s=e.split("."),r=parseInt(s[0]),a=parseInt(s[1]);if(this.#clicked)if(this.#cleanAllSquaresAndMarksAux(),r>this.#squareI&&a==this.#squareJ)for(i=this.#squareI;i<=r;)this.#refreshSquareAndMark(i,this.#squareJ),i++;else if(r<this.#squareI&&a==this.#squareJ)for(i=r;i<=this.#squareI;)this.#refreshSquareAndMark(i,this.#squareJ),i++;else if(r==this.#squareI&&a>this.#squareJ)for(i=this.#squareJ;i<=a;)this.#refreshSquareAndMark(this.#squareI,i),i++;else if(r==this.#squareI&&a<this.#squareJ)for(i=a;i<=this.#squareJ;)this.#refreshSquareAndMark(this.#squareI,i),i++;this.#refreshCalculatedValues(r,a)}}#markSquareNumber(t){if(!this.#totalValidated){let e=t.target.getAttribute("opacity"),i=t.target.getAttribute("id");i=i.replace("squareNumber_","");let s=i.split("."),r=parseInt(s[0]),a=parseInt(s[1]),u=parseInt(s[2]),l=document.getElementById("number_"+r+"."+a+"."+u);"1"==e?(t.target.setAttribute("opacity","0"),l.setAttribute("fill",t.target.getAttribute("fill")),l.setAttribute("font-weight","bold")):(t.target.setAttribute("opacity","1"),l.setAttribute("fill","#ffffff"),l.setAttribute("font-weight","normal"))}}#markNumber(t){if(!this.#totalValidated){let e=t.target.getAttribute("fill"),i=t.target.getAttribute("id");i=i.replace("number_","");let s=i.split("."),r=parseInt(s[0]),a=parseInt(s[1]),u=parseInt(s[2]),l=document.getElementById("squareNumber_"+r+"."+a+"."+u);e==this.#data.colors[0]?(l.setAttribute("opacity","0"),t.target.setAttribute("fill",l.getAttribute("fill")),t.target.setAttribute("font-weight","bold")):(l.setAttribute("opacity","1"),t.target.setAttribute("fill","#ffffff"),t.target.setAttribute("font-weight","normal"))}}#switchSquareColor(){let t,e,i=document.getElementById("palette").children;for(let e=0;e<i.length;e++)if(3==i[e].getAttribute("stroke-width")){t=e==i.length-1?0:e+1;break}this.#colorSelected=this.#data.colors[t+1],i[t].setAttribute("stroke-width","3");for(let i=1;i<this.#data.colors.length;i++)e=document.getElementById("squareColor_"+i),i!=t+1&&e.setAttribute("stroke-width","1")}#endColorsChange(){if(this.#clicked&&null!=this.#data){let t,e,i,s,r,a;for(let u=0;u<this.#data.settings.width;u++)for(let l=0;l<this.#data.settings.height;l++)t=document.getElementById("square_aux_"+u+"."+l),"1"==t.getAttribute("opacity")&&(e=t.getAttribute("id"),e=e.replace("square_aux_","square_"),i=document.getElementById(e),s=t.getAttribute("fill"),i.setAttribute("fill",s),s==this.#data.colors[0]?i.setAttribute("opacity","0"):i.setAttribute("opacity","1"),t.setAttribute("fill",this.#data.colors[0]),t.setAttribute("opacity","0")),r=document.getElementById("mark_aux_"+u+"."+l),"1"==r.getAttribute("opacity")?(e=r.getAttribute("id"),e=e.replace("mark_aux_","mark_"),a=document.getElementById(e),a.setAttribute("opacity","1"),r.setAttribute("opacity","0")):"0.1"==r.getAttribute("opacity")&&(e=r.getAttribute("id"),e=e.replace("mark_aux_","mark_"),a=document.getElementById(e),a.setAttribute("opacity","0"),r.setAttribute("opacity","0"));this.#clicked=!1,this.#validate(),this.#saveState()}}}