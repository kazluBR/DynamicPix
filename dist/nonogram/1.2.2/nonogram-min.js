//compress by https://codebeautify.org/minify-js
const SVG_LIB="http://www.w3.org/2000/svg",SQUARE_COLOR_SIZE=40,TRANSLATE_X=10,TRANSLATE_Y=0,LINE_COLOR="#808080",MARK_COLOR="#808080",CALCULATED_EMPTY_COLOR="#808080",RULE_COLOR="#ff00ff",SIGNAL_CORRECT_COLOR="#adff2f",SIGNAL_ERROR_COLOR="#b22222",NUMBER_DEFAULT_COLOR="#ffffff";class nonogram{#t;#e;#i;#s;#r;#a;#l;#u;#h;#o;#n;#d;#c;#g;#m;#b;#A;constructor(t={}){this.#t=t.size||20,this.#e=t.showErrorsOnCheck||!1,this.#i=t.showErrorsImmediately||!1,this.#s=t.keepCorrectPaintedSquares||!1,this.#r=t.finishCallback||(()=>alert("Puzzle Finished!")),this.#a={},this.#l=!1,this.#u=!1,this.#h=[],this.#o=0,this.#n=null,this.#d=null,this.#c=null,this.#m=null,this.#b=null,this.#A=!1,document.body.onmousedown=t=>{if(1==t.button)return this.#f(),!1},document.body.onmouseup=()=>this.#y(),this.#z()}init(t,e=null){this.#a=t,this.#p(),this.#S(),this.#l=!1,this.#m=t.colors[1],this.#I();let i=this.#a.settings.horizontalNumbersLength*this.#t,s=this.#a.settings.verticalNumbersLength*this.#t;this.#q(i,s);for(let t=0;t<this.#a.settings.width;t++)for(let e=0;e<this.#a.settings.height;e++)this.#_(i,s,t,e),this.#E(i,s,t,e),this.#i&&this.#B(i,s,t,e),this.#k(i,s,t,e),this.#C(i,s,t,e);for(let t=0;t<=this.#a.settings.width;t++){if(t<this.#a.settings.width){this.#x(i,s,0,t);for(let e=1;e<=this.#a.verticalNumbers[t].length;e++)this.#w(i,s,0,t,e),this.#N(i,s,0,t,e)}this.#L(i,s,0,t)}for(let t=0;t<=this.#a.settings.height;t++){if(t<this.#a.settings.height){this.#x(i,s,1,t);for(let e=1;e<=this.#a.horizontalNumbers[t].length;e++)this.#w(i,s,1,t,e),this.#N(i,s,1,t,e)}this.#L(i,s,1,t)}this.#v(i,s,0),this.#v(i,s,1),this.loadState(e),this.#V(),this.#M()}maximize(t){this.#a&&(this.#t+=t||1,this.#O())}minimize(t){this.#a&&(this.#t-=t||1,this.#t<1?this.#t+=t||1:this.#O())}undo(){this.#a&&this.#o>0&&(this.#o-=1,this.#R())}redo(){this.#a&&this.#o<this.#h.length-1&&(this.#o+=1,this.#R())}check(){if(this.#a){let t,e,i,s,r,a=0;for(let l=0;l<this.#a.settings.width;l++){s=document.getElementById("signal_0."+l);for(let u=0;u<this.#a.settings.height;u++)t=document.getElementById("square_"+l+"."+u),e=t.getAttribute("fill"),i=t.getAttribute("opacity"),r=document.getElementById("signal_1."+u),e!=this.#a.colors[this.#a.points[u][l]]&&"1"==i&&(this.#e&&(s.setAttribute("opacity","1"),s.setAttribute("fill","#b22222"),r.setAttribute("opacity","1"),r.setAttribute("fill","#b22222")),a++)}return a}}solve(){if(this.#a){for(let t=0;t<this.#a.settings.height;t++)for(let e=0;e<this.#a.settings.width;e++){let i=document.getElementById("square_"+e+"."+t);i.setAttribute("fill",this.#a.colors[this.#a.points[t][e]]),i.setAttribute("opacity","1")}this.#G()}}getState(){let t="";if(this.#a)for(let e=0;e<this.#a.settings.height;e++){for(let i=0;i<this.#a.settings.width;i++){let s=document.getElementById("square_"+i+"."+e);t+=this.#a.colors.indexOf(s.getAttribute("fill"))+","}t+=";"}return t}loadState(t){if(this.#a){if(t){let e=t.split(";");for(let t=0;t<this.#a.settings.height;t++){let i=e[t].split(",");for(let e=0;e<this.#a.settings.width;e++){let s=document.getElementById("square_"+e+"."+t);s.setAttribute("fill",this.#a.colors[i[e]]),i[e]>0?s.setAttribute("opacity","1"):s.setAttribute("opacity","0")}}}this.#G()}}makeMove(t){if("PAINT"==t.action)for(let e=0;e<t.squares.length;e++){let i=document.getElementById("square_"+t.squares[e].i+"."+t.squares[e].j);i.setAttribute("fill",t.color),t.color==this.#a.colors[0]?i.setAttribute("opacity","0"):i.setAttribute("opacity","1")}else for(let e=0;e<t.squares.length;e++){let i=document.getElementById("mark_"+t.squares[e].i+"."+t.squares[e].j);"MARK"==t.action?i.setAttribute("opacity","1"):"UNMARK"==t.action&&i.setAttribute("opacity","0")}this.#G(),this.#V()}undoMove(t){if("PAINT"==t.action)for(let e=0;e<t.squares.length;e++){let i=document.getElementById("square_"+t.squares[e].i+"."+t.squares[e].j);i.setAttribute("fill",t.squares[e].previousColor),t.squares[e].previousColor==this.#a.colors[0]?i.setAttribute("opacity","0"):i.setAttribute("opacity","1")}else for(let e=0;e<t.squares.length;e++){let i=document.getElementById("mark_"+t.squares[e].i+"."+t.squares[e].j);"MARK"==t.action?i.setAttribute("opacity","0"):"UNMARK"==t.action&&i.setAttribute("opacity","1")}this.#G(),this.#V()}freeze(){this.#A=!0}unfreeze(){this.#A=!1}#z(){let t=document.getElementById("nonogram");t.oncontextmenu=function(){return!1};let e=document.createElementNS(SVG_LIB,"svg"),i=document.createElementNS(SVG_LIB,"g");i.setAttribute("id","palette"),e.appendChild(i);let s=document.createElementNS(SVG_LIB,"g");s.setAttribute("id","main"),e.appendChild(s);let r=document.createElementNS(SVG_LIB,"g");r.setAttribute("id","components"),e.appendChild(r);let a=document.createElementNS(SVG_LIB,"g");a.setAttribute("id","aux"),e.appendChild(a),t.appendChild(e)}#I(){let t="translate(10,0)";if(document.getElementById("palette").setAttribute("transform",t),this.#a.colors.length>2){t="translate(10,"+60+")";for(let t=1;t<this.#a.colors.length;t++)this.#J(t)}document.getElementById("main").setAttribute("transform",t),document.getElementById("components").setAttribute("transform",t),document.getElementById("aux").setAttribute("transform",t)}#J(t){let e=document.createElementNS(SVG_LIB,"rect");e.setAttribute("id","squareColor_"+t),1==t?e.setAttribute("stroke-width","3"):e.setAttribute("stroke-width","1"),e.setAttribute("stroke","black"),e.setAttribute("height",40),e.setAttribute("width",40),e.setAttribute("fill",this.#a.colors[t]),e.setAttribute("x",40*(t-1)+5),e.setAttribute("y",5),e.onclick=t=>this.#P(t),document.getElementById("palette").appendChild(e)}#q(t,e){let i=document.createElementNS(SVG_LIB,"rect");i.setAttribute("id","background"),i.setAttribute("fill",this.#a.colors[0]),i.setAttribute("height",this.#t*this.#a.settings.height),i.setAttribute("width",this.#t*this.#a.settings.width),i.setAttribute("x",t),i.setAttribute("y",e),document.getElementById("main").appendChild(i)}#_(t,e,i,s){let r=document.createElementNS(SVG_LIB,"text");r.setAttribute("id","mark_"+i+"."+s),r.setAttribute("text-anchor","middle"),r.setAttribute("font-family","serif"),r.setAttribute("font-size",this.#t),r.setAttribute("fill","#808080"),r.setAttribute("x",t+(i+.5)*this.#t),r.setAttribute("y",e+(s+.85)*this.#t),r.setAttribute("opacity","0"),r.textContent="•",r.setAttribute("style","-webkit-user-select: none;-moz-user-select: none;-ms-user-select: none;user-select: none;"),document.getElementById("main").appendChild(r)}#k(t,e,i,s){let r=document.createElementNS(SVG_LIB,"text");r.setAttribute("id","mark_aux_"+i+"."+s),r.setAttribute("text-anchor","middle"),r.setAttribute("font-family","serif"),r.setAttribute("font-size",this.#t),r.setAttribute("fill","#808080"),r.setAttribute("x",t+(i+.5)*this.#t),r.setAttribute("y",e+(s+.85)*this.#t),r.setAttribute("opacity","0"),r.textContent="•",r.setAttribute("style","-webkit-user-select: none;-moz-user-select: none;-ms-user-select: none;user-select: none;"),document.getElementById("aux").appendChild(r)}#B(t,e,i,s){let r=document.createElementNS(SVG_LIB,"text");r.setAttribute("id","error_mark_"+i+"."+s),r.setAttribute("text-anchor","middle"),r.setAttribute("font-family","serif"),r.setAttribute("font-size",this.#t),r.setAttribute("x",t+(i+.5)*this.#t),r.setAttribute("y",e+(s+.85)*this.#t),r.setAttribute("opacity","0"),r.textContent="✕",r.setAttribute("style","-webkit-user-select: none;-moz-user-select: none;-ms-user-select: none;user-select: none;"),document.getElementById("main").appendChild(r)}#E(t,e,i,s){let r=document.createElementNS(SVG_LIB,"rect");r.setAttribute("id","square_"+i+"."+s),r.setAttribute("fill",this.#a.colors[0]),r.setAttribute("opacity","0"),r.setAttribute("height",.9*this.#t),r.setAttribute("width",.9*this.#t),r.setAttribute("x",t+i*this.#t+.05*this.#t),r.setAttribute("y",e+s*this.#t+.05*this.#t),document.getElementById("main").appendChild(r)}#C(t,e,i,s){let r=document.createElementNS(SVG_LIB,"rect");r.setAttribute("id","square_aux_"+i+"."+s),r.setAttribute("fill",this.#a.colors[0]),r.setAttribute("opacity","0"),r.setAttribute("height",.9*this.#t),r.setAttribute("width",.9*this.#t),r.setAttribute("x",t+i*this.#t+.05*this.#t),r.setAttribute("y",e+s*this.#t+.05*this.#t),r.onmouseover=t=>this.#K(t),r.onmouseout=t=>this.#T(t),r.onmousedown=t=>this.#j(t),r.onmousemove=t=>this.#D(t),document.getElementById("aux").appendChild(r)}#x(t,e,i,s){let r=document.createElementNS(SVG_LIB,"text");r.setAttribute("id","signal_"+i+"."+s),r.setAttribute("font-size",this.#t),r.setAttribute("opacity","0"),0==i?(r.setAttribute("text-anchor","start"),r.setAttribute("x",t+s*this.#t),r.setAttribute("y",e+(this.#a.settings.height+1)*this.#t),r.textContent="⏶"):(r.setAttribute("text-anchor","end"),r.setAttribute("x",t+(this.#a.settings.width+1)*this.#t),r.setAttribute("y",e+(s+.9)*this.#t),r.textContent="⏴"),r.setAttribute("style","-webkit-user-select: none;-moz-user-select: none;-ms-user-select: none;user-select: none;"),document.getElementById("components").appendChild(r)}#w(t,e,i,s,r){let a=document.createElementNS(SVG_LIB,"rect");if(a.setAttribute("id","squareNumber_"+i+"."+s+"."+(r-1)),a.setAttribute("opacity","1"),a.setAttribute("height",this.#t),a.setAttribute("width",this.#t),0==i){a.setAttribute("x",t+s*this.#t),a.setAttribute("y",e-r*this.#t);let i=this.#a.verticalNumbers[s][r-1].color;a.setAttribute("fill",this.#a.colors[i])}else{a.setAttribute("x",t-r*this.#t),a.setAttribute("y",e+s*this.#t);let i=this.#a.horizontalNumbers[s][r-1].color;a.setAttribute("fill",this.#a.colors[i])}a.onclick=t=>this.#U(t),document.getElementById("components").appendChild(a)}#N(t,e,i,s,r){let a=document.createElementNS(SVG_LIB,"text");a.setAttribute("id","number_"+i+"."+s+"."+(r-1)),a.setAttribute("text-anchor","middle"),a.setAttribute("font-family","serif"),a.setAttribute("font-size",.9*this.#t),a.setAttribute("font-weight","normal"),a.setAttribute("fill","#ffffff"),0==i?(a.setAttribute("x",t+s*this.#t+.5*this.#t),a.setAttribute("y",e-r*this.#t+.8*this.#t),a.textContent=this.#a.verticalNumbers[s][r-1].number):(a.setAttribute("x",t-r*this.#t+.5*this.#t),a.setAttribute("y",e+s*this.#t+.8*this.#t),a.textContent=this.#a.horizontalNumbers[s][r-1].number),a.setAttribute("style","-webkit-user-select: none;-moz-user-select: none;-ms-user-select: none;user-select: none;"),a.onclick=t=>this.#Z(t),document.getElementById("components").appendChild(a)}#L(t,e,i,s){let r=document.createElementNS(SVG_LIB,"line");r.setAttribute("id","line_"+i+"."+s),r.setAttribute("stroke","#808080"),s%this.#a.settings.gridLength==0?r.setAttribute("stroke-width","2"):r.setAttribute("stroke-width","1"),0==i?(r.setAttribute("x1",t+s*this.#t),r.setAttribute("x2",t+s*this.#t),r.setAttribute("y1",e-this.#a.settings.verticalNumbersLength*this.#t),r.setAttribute("y2",e+this.#a.settings.height*this.#t)):(r.setAttribute("x1",t-this.#a.settings.horizontalNumbersLength*this.#t),r.setAttribute("x2",t+this.#a.settings.width*this.#t),r.setAttribute("y1",e+s*this.#t),r.setAttribute("y2",e+s*this.#t)),document.getElementById("components").appendChild(r)}#v(t,e,i){let s=document.createElementNS(SVG_LIB,"text");s.setAttribute("id","calculated_"+i),s.setAttribute("font-family","serif"),s.setAttribute("font-size",this.#t),s.setAttribute("font-weight","bold"),s.setAttribute("fill","#808080"),0==i?(s.setAttribute("text-anchor","start"),s.setAttribute("x",t+(this.#a.settings.width+1)*this.#t+this.#t/4)):(s.setAttribute("text-anchor","middle"),s.setAttribute("y",e+(this.#a.settings.height+1)*this.#t+this.#t)),s.setAttribute("style","-webkit-user-select: none;-moz-user-select: none;-ms-user-select: none;user-select: none;"),document.getElementById("components").appendChild(s)}#M(){document.getElementById("nonogram").style="cursor: url(\"data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' width='32' height='32' viewBox='0 0 24 24'%3e%3cpath fill='%23"+this.#m.replace("#","")+"' stroke='black' d='M7.127 22.562l-7.127 1.438 1.438-7.128 5.689 5.69zm1.414-1.414l11.228-11.225-5.69-5.692-11.227 11.227 5.689 5.69zm9.768-21.148l-2.816 2.817 5.691 5.691 2.816-2.819-5.691-5.689z'/%3e%3c/svg%3e\") 0 32, pointer;"}#p(){let t=document.getElementById("palette");for(;t.firstChild;)t.removeChild(t.firstChild);let e=document.getElementById("components");for(;e.firstChild;)e.removeChild(e.firstChild);let i=document.getElementById("main");for(;i.firstChild;)i.removeChild(i.firstChild);let s=document.getElementById("aux");for(;s.firstChild;)s.removeChild(s.firstChild);this.#h=[]}#S(){let t=document.getElementsByTagName("svg")[0];t.setAttribute("height",this.#t*this.#a.settings.verticalNumbersLength+this.#t*(this.#a.settings.height+3)+0+60),t.setAttribute("width",this.#t*this.#a.settings.horizontalNumbersLength+this.#t*(this.#a.settings.width+3)+10)}#G(){let t,e,i,s,r,a;this.#l=!0;for(let l=0;l<this.#a.settings.width;l++){t=!0,s=document.getElementById("signal_0."+l);for(let r=0;r<this.#a.settings.height;r++)if(e=document.getElementById("square_"+l+"."+r),i=e.getAttribute("fill"),i!=this.#a.colors[this.#a.points[r][l]]){t=!1,this.#l=!1,"1"==s.getAttribute("opacity")&&s.setAttribute("opacity","0");break}if(t){for(let t=0;t<this.#a.verticalNumbers[l].length;t++)r=document.getElementById("squareNumber_0."+l+"."+t),r.setAttribute("opacity","0"),a=document.getElementById("number_0."+l+"."+t),a.setAttribute("fill",r.getAttribute("fill")),a.setAttribute("font-weight","bold");"0"!=s.getAttribute("opacity")&&"#b22222"!=s.getAttribute("fill")||(s.setAttribute("fill","#adff2f"),s.setAttribute("opacity","1"))}}for(let l=0;l<this.#a.settings.height;l++){t=!0,s=document.getElementById("signal_1."+l);for(let r=0;r<this.#a.settings.width;r++)if(e=document.getElementById("square_"+r+"."+l),i=e.getAttribute("fill"),i!=this.#a.colors[this.#a.points[l][r]]){t=!1,this.#l=!1,"1"==s.getAttribute("opacity")&&s.setAttribute("opacity","0");break}if(t){for(let t=0;t<this.#a.horizontalNumbers[l].length;t++)r=document.getElementById("squareNumber_1."+l+"."+t),r.setAttribute("opacity","0"),a=document.getElementById("number_1."+l+"."+t),a.setAttribute("fill",r.getAttribute("fill")),a.setAttribute("font-weight","bold");"0"!=s.getAttribute("opacity")&&"#b22222"!=s.getAttribute("fill")||(s.setAttribute("fill","#adff2f"),s.setAttribute("opacity","1"))}}if(this.#l){let t;for(let e=0;e<this.#a.settings.height;e++)for(let i=0;i<this.#a.settings.width;i++)t=document.getElementById("mark_"+i+"."+e),t.setAttribute("opacity","0");document.getElementById("calculated_0").textContent="",document.getElementById("calculated_1").textContent="",this.#r()}}#O(){this.#S();let t=this.#a.settings.horizontalNumbersLength*this.#t,e=this.#a.settings.verticalNumbersLength*this.#t;this.#F(t,e);for(let i=0;i<this.#a.settings.width;i++)for(let s=0;s<this.#a.settings.height;s++)this.#X(t,e,i,s),this.#Y(t,e,i,s),this.#Q(t,e,i,s),this.#H(t,e,i,s);for(let i=0;i<=this.#a.settings.width;i++){if(i<this.#a.settings.width){this.#W(t,e,0,i);for(let s=1;s<=this.#a.verticalNumbers[i].length;s++)this.#$(t,e,0,i,s),this.#tt(t,e,0,i,s)}this.#et(t,e,0,i)}for(let i=0;i<=this.#a.settings.height;i++){if(i<this.#a.settings.height){this.#W(t,e,1,i);for(let s=1;s<=this.#a.horizontalNumbers[i].length;s++)this.#$(t,e,1,i,s),this.#tt(t,e,1,i,s)}this.#et(t,e,1,i)}this.#it(t,e,0),this.#it(t,e,1)}#F(t,e){let i=document.getElementById("background");i.setAttribute("height",this.#t*this.#a.settings.height),i.setAttribute("width",this.#t*this.#a.settings.width),i.setAttribute("x",t),i.setAttribute("y",e)}#X(t,e,i,s){let r=document.getElementById("mark_"+i+"."+s);r.setAttribute("font-size",this.#t),r.setAttribute("x",t+(i+.5)*this.#t),r.setAttribute("y",e+(s+.85)*this.#t)}#Y(t,e,i,s){let r=document.getElementById("mark_aux_"+i+"."+s);r.setAttribute("font-size",this.#t),r.setAttribute("x",t+(i+.5)*this.#t),r.setAttribute("y",e+(s+.85)*this.#t)}#Q(t,e,i,s){let r=document.getElementById("square_"+i+"."+s);r.setAttribute("height",.9*this.#t),r.setAttribute("width",.9*this.#t),r.setAttribute("x",t+i*this.#t+.05*this.#t),r.setAttribute("y",e+s*this.#t+.05*this.#t)}#H(t,e,i,s){let r=document.getElementById("square_aux_"+i+"."+s);r.setAttribute("height",.9*this.#t),r.setAttribute("width",.9*this.#t),r.setAttribute("x",t+i*this.#t+.05*this.#t),r.setAttribute("y",e+s*this.#t+.05*this.#t)}#W(t,e,i,s){let r=document.getElementById("signal_"+i+"."+s);r.setAttribute("font-size",this.#t),0==i?(r.setAttribute("x",t+s*this.#t),r.setAttribute("y",e+(this.#a.settings.height+1)*this.#t)):(r.setAttribute("x",t+(this.#a.settings.width+1)*this.#t),r.setAttribute("y",e+(s+.9)*this.#t))}#tt(t,e,i,s,r){let a=document.getElementById("number_"+i+"."+s+"."+(r-1));a.setAttribute("font-size",.9*this.#t),0==i?(a.setAttribute("x",t+s*this.#t+.5*this.#t),a.setAttribute("y",e-r*this.#t+.8*this.#t)):(a.setAttribute("x",t-r*this.#t+.5*this.#t),a.setAttribute("y",e+s*this.#t+.8*this.#t))}#$(t,e,i,s,r){let a=document.getElementById("squareNumber_"+i+"."+s+"."+(r-1));a.setAttribute("height",this.#t),a.setAttribute("width",this.#t),0==i?(a.setAttribute("x",t+s*this.#t),a.setAttribute("y",e-r*this.#t)):(a.setAttribute("x",t-r*this.#t),a.setAttribute("y",e+s*this.#t))}#et(t,e,i,s){let r=document.getElementById("line_"+i+"."+s);0==i?(r.setAttribute("x1",t+s*this.#t),r.setAttribute("x2",t+s*this.#t),r.setAttribute("y1",e-this.#a.settings.verticalNumbersLength*this.#t),r.setAttribute("y2",e+this.#a.settings.height*this.#t)):(r.setAttribute("x1",t-this.#a.settings.horizontalNumbersLength*this.#t),r.setAttribute("x2",t+this.#a.settings.width*this.#t),r.setAttribute("y1",e+s*this.#t),r.setAttribute("y2",e+s*this.#t))}#it(t,e,i){let s=document.getElementById("calculated_"+i);s.setAttribute("font-size",this.#t),0==i?s.setAttribute("x",t+(this.#a.settings.width+1)*this.#t+this.#t/4):s.setAttribute("y",e+(this.#a.settings.height+1)*this.#t+this.#t)}#V(){for(;this.#o<this.#h.length-1;)this.#h.pop();this.#h.push((new XMLSerializer).serializeToString(document.getElementById("main"))),this.#h.length>1&&(this.#o+=1)}#R(){let t=document.getElementById("main");for(;t.firstChild;)t.removeChild(t.firstChild);let e=(new DOMParser).parseFromString(this.#h[this.#o],"image/svg+xml").documentElement;for(;e.firstChild;)t.appendChild(e.firstChild);this.#G(),this.#O()}#st(t,e){let i=document.getElementById("square_"+t+"."+e);this.#u&&(i=document.getElementById("square_aux_"+t+"."+e));let s,r,a=i.getAttribute("fill"),l=1,u=t+1;for(;u<=this.#a.settings.width-1&&(s=document.getElementById("square_"+u+"."+e),r=document.getElementById("square_aux_"+u+"."+e),s.getAttribute("fill")==a||r.getAttribute("fill")==a&&a!=this.#a.colors[0]);)u++,l++;let h=t-1;for(;h>=0&&(s=document.getElementById("square_"+h+"."+e),r=document.getElementById("square_aux_"+h+"."+e),s.getAttribute("fill")==a||r.getAttribute("fill")==a&&a!=this.#a.colors[0]);)h--,l++;let o=1,n=e+1;for(;n<=this.#a.settings.height-1&&(s=document.getElementById("square_"+t+"."+n),r=document.getElementById("square_aux_"+t+"."+n),s.getAttribute("fill")==a||r.getAttribute("fill")==a&&a!=this.#a.colors[0]);)n++,o++;let d=e-1;for(;d>=0&&(s=document.getElementById("square_"+t+"."+d),r=document.getElementById("square_aux_"+t+"."+d),s.getAttribute("fill")==a||r.getAttribute("fill")==a&&a!=this.#a.colors[0]);)d--,o++;let c=document.getElementById("calculated_0"),g=document.getElementById("calculated_1");a!=this.#a.colors[0]?(c.setAttribute("fill",a),g.setAttribute("fill",a)):(c.setAttribute("fill","#808080"),g.setAttribute("fill","#808080")),c.textContent=l,g.textContent=o;let m=this.#a.settings.verticalNumbersLength*this.#t;c.setAttribute("y",m+this.#t*(e+.9));let b=this.#a.settings.horizontalNumbersLength*this.#t;g.setAttribute("x",b+this.#t*(t+.5))}#rt(){for(let t=0;t<this.#a.settings.width;t++)for(let e=0;e<this.#a.settings.height;e++){let i=document.getElementById("square_aux_"+t+"."+e);"1"==i.getAttribute("opacity")&&(t==this.#n&&e==this.#d||(i.setAttribute("fill",this.#a.colors[0]),i.setAttribute("opacity","0")));let s=document.getElementById("mark_aux_"+t+"."+e);"1"==s.getAttribute("opacity")&&(t==this.#n&&e==this.#d||s.setAttribute("opacity","0"))}}#at(t,e){let i=document.getElementById("square_aux_"+t+"."+e),s=document.getElementById("square_"+t+"."+e),r=document.getElementById("mark_aux_"+t+"."+e),a=document.getElementById("mark_"+t+"."+e),l=s.getAttribute("fill");if(!this.#s||l!=this.#a.colors[this.#a.points[e][t]]||this.#b)if(this.#b)l==this.#a.colors[0]&&r.setAttribute("opacity","1");else if(this.#c==this.#a.colors[0])i.setAttribute("fill",this.#c),i.setAttribute("opacity","1"),r.setAttribute("opacity","0.1");else{let t=a.getAttribute("opacity");l==this.#a.colors[0]&&"0"==t&&(i.setAttribute("fill",this.#c),i.setAttribute("opacity","1"))}}#lt(t){0===t.indexOf("#")&&(t=t.slice(1)),3===t.length&&(t=t[0]+t[0]+t[1]+t[1]+t[2]+t[2]);let e=(255-parseInt(t.slice(0,2),16)).toString(16),i=(255-parseInt(t.slice(2,4),16)).toString(16),s=(255-parseInt(t.slice(4,6),16)).toString(16);return"#"+this.#ut(e)+this.#ut(i)+this.#ut(s)}#ut(t,e){return e=e||2,(new Array(e).join("0")+t).slice(-e)}#P(t){let e=t.target.getAttribute("id");e=e.replace("squareColor_",""),this.#m=this.#a.colors[e],t.target.setAttribute("stroke-width","3");for(let t=1;t<this.#a.colors.length;t++){let i=document.getElementById("squareColor_"+t);t!=e&&i.setAttribute("stroke-width","1")}this.#M()}#K(t){if(!this.#l&&!this.#A){let e=t.target.getAttribute("id");e=e.replace("square_aux_","");let i=e.split("."),s=parseInt(i[0]),r=parseInt(i[1]),a=document.getElementById("line_0."+s);a.setAttribute("stroke","#ff00ff"),s%this.#a.settings.gridLength!=0&&a.setAttribute("stroke-width","2");let l=document.getElementById("line_1."+r);l.setAttribute("stroke","#ff00ff"),r%this.#a.settings.gridLength!=0&&l.setAttribute("stroke-width","2"),s+=1,r+=1,a=document.getElementById("line_0."+s),a.setAttribute("stroke","#ff00ff"),s%this.#a.settings.gridLength!=0&&a.setAttribute("stroke-width","2"),l=document.getElementById("line_1."+r),l.setAttribute("stroke","#ff00ff"),r%this.#a.settings.gridLength!=0&&l.setAttribute("stroke-width","2")}}#T(t){if(!this.#l&&!this.#A){let e=t.target.getAttribute("id");e=e.replace("square_aux_","");let i=e.split("."),s=parseInt(i[0]),r=parseInt(i[1]),a=document.getElementById("line_0."+s);a.setAttribute("stroke","#808080"),s%this.#a.settings.gridLength!=0&&a.setAttribute("stroke-width","1");let l=document.getElementById("line_1."+r);l.setAttribute("stroke","#808080"),r%this.#a.settings.gridLength!=0&&l.setAttribute("stroke-width","1"),s+=1,r+=1,a=document.getElementById("line_0."+s),a.setAttribute("stroke","#808080"),s%this.#a.settings.gridLength!=0&&a.setAttribute("stroke-width","1"),l=document.getElementById("line_1."+r),l.setAttribute("stroke","#808080"),r%this.#a.settings.gridLength!=0&&l.setAttribute("stroke-width","1"),document.getElementById("calculated_0").textContent="",document.getElementById("calculated_1").textContent=""}}#j(t){if(!this.#l&&1!=t.button&&!this.#A){let e=t.target.getAttribute("id");e=e.replace("square_aux_","");let i=e.split(".");this.#n=parseInt(i[0]),this.#d=parseInt(i[1]);let s=document.getElementById("square_"+this.#n+"."+this.#d);this.#c=s.getAttribute("fill");let r=document.getElementById("mark_aux_"+this.#n+"."+this.#d),a=document.getElementById("mark_"+this.#n+"."+this.#d),l=a.getAttribute("opacity");if(this.#b=!1,this.#g=this.#c,this.#c==this.#a.colors[0])"0"==l?0==t.button?(t.target.setAttribute("fill",this.#m),t.target.setAttribute("opacity","1"),s.setAttribute("fill",this.#m),s.setAttribute("opacity","1"),this.#c=this.#m):(r.setAttribute("opacity","1"),a.setAttribute("opacity","1"),this.#b=!0):(0==t.button&&(t.target.setAttribute("fill",this.#m),t.target.setAttribute("opacity","1"),s.setAttribute("fill",this.#m),s.setAttribute("opacity","1"),this.#c=this.#m),r.setAttribute("opacity","0.1"),a.setAttribute("opacity","0"));else{if(this.#s&&this.#c==this.#a.colors[this.#a.points[this.#d][this.#n]])return;0==t.button?this.#c!=this.#m?(t.target.setAttribute("fill",this.#m),t.target.setAttribute("opacity","1"),s.setAttribute("fill",this.#m),this.#c=this.#m):(t.target.setAttribute("fill",this.#a.colors[0]),t.target.setAttribute("opacity","1"),s.setAttribute("fill",this.#a.colors[0]),s.setAttribute("opacity","0"),this.#c=this.#a.colors[0]):(t.target.setAttribute("fill",this.#a.colors[0]),t.target.setAttribute("opacity","0"),s.setAttribute("fill",this.#a.colors[0]),s.setAttribute("opacity","0"),r.setAttribute("opacity","1"),a.setAttribute("opacity","1"),this.#b=!0)}this.#u=!0,this.#st(this.#n,this.#d)}}#D(t){if(!this.#l&&!this.#A){let e=t.target.getAttribute("id");e=e.replace("square_aux_","");let i=e.split("."),s=parseInt(i[0]),r=parseInt(i[1]),a=0;if(this.#u)if(this.#rt(),s>this.#n&&r==this.#d)for(a=this.#n;a<=s;)this.#at(a,this.#d),a++;else if(s<this.#n&&r==this.#d)for(a=s;a<=this.#n;)this.#at(a,this.#d),a++;else if(s==this.#n&&r>this.#d)for(a=this.#d;a<=r;)this.#at(this.#n,a),a++;else if(s==this.#n&&r<this.#d)for(a=r;a<=this.#d;)this.#at(this.#n,a),a++;this.#st(s,r)}}#U(t){if(!this.#l&&!this.#A){let e=t.target.getAttribute("opacity"),i=t.target.getAttribute("id");i=i.replace("squareNumber_","");let s=i.split("."),r=parseInt(s[0]),a=parseInt(s[1]),l=parseInt(s[2]),u=document.getElementById("number_"+r+"."+a+"."+l);"1"==e?(t.target.setAttribute("opacity","0"),u.setAttribute("fill",t.target.getAttribute("fill")),u.setAttribute("font-weight","bold")):(t.target.setAttribute("opacity","1"),u.setAttribute("fill","#ffffff"),u.setAttribute("font-weight","normal"))}}#Z(t){if(!this.#l&&!this.#A){let e=t.target.getAttribute("fill"),i=t.target.getAttribute("id");i=i.replace("number_","");let s=i.split("."),r=parseInt(s[0]),a=parseInt(s[1]),l=parseInt(s[2]),u=document.getElementById("squareNumber_"+r+"."+a+"."+l);e==this.#a.colors[0]?(u.setAttribute("opacity","0"),t.target.setAttribute("fill",u.getAttribute("fill")),t.target.setAttribute("font-weight","bold")):(u.setAttribute("opacity","1"),t.target.setAttribute("fill","#ffffff"),t.target.setAttribute("font-weight","normal"))}}#f(){let t=document.getElementById("palette").children;if(t.length>0){let e=0;for(let i=0;i<t.length;i++)if(3==t[i].getAttribute("stroke-width")){e=i==t.length-1?0:i+1;break}this.#m=this.#a.colors[e+1],t[e].setAttribute("stroke-width","3");for(let t=1;t<this.#a.colors.length;t++){let i=document.getElementById("squareColor_"+t);t!=e+1&&i.setAttribute("stroke-width","1")}this.#M()}}#y(){if(this.#u&&this.#a){let t={action:this.#b?"MARK":"PAINT",color:this.#c,squares:[]};for(let e=0;e<this.#a.settings.width;e++)for(let i=0;i<this.#a.settings.height;i++){let s=document.getElementById("square_aux_"+e+"."+i);if("1"==s.getAttribute("opacity")){let r=s.getAttribute("id");r=r.replace("square_aux_","square_");let a=document.getElementById(r),l=s.getAttribute("fill"),u=a.getAttribute("fill");if(u!=this.#g&&(u=this.#g),a.setAttribute("fill",l),l==this.#a.colors[0]?a.setAttribute("opacity","0"):a.setAttribute("opacity","1"),s.setAttribute("fill",this.#a.colors[0]),s.setAttribute("opacity","0"),t.squares.push({i:e,j:i,previousColor:u}),this.#i){let t=document.getElementById("error_mark_"+e+"."+i);l==this.#a.colors[this.#a.points[i][e]]||l==this.#a.colors[0]?t.setAttribute("opacity","0"):(t.setAttribute("fill",this.#lt(l)),t.setAttribute("opacity","1"))}}let r=document.getElementById("mark_aux_"+e+"."+i);if("1"==r.getAttribute("opacity")){let s=r.getAttribute("id");if(s=s.replace("mark_aux_","mark_"),document.getElementById(s).setAttribute("opacity","1"),r.setAttribute("opacity","0"),t.squares.push({i:e,j:i}),this.#i){document.getElementById("error_mark_"+e+"."+i).setAttribute("opacity","0")}}else if("0.1"==r.getAttribute("opacity")){let s=r.getAttribute("id");s=s.replace("mark_aux_","mark_"),document.getElementById(s).setAttribute("opacity","0"),r.setAttribute("opacity","0"),0==t.squares.length&&(t.squares.push({i:e,j:i}),t.action="UNMARK")}}this.#u=!1,this.#G(),this.#V();let e=new CustomEvent("receiveMove",{detail:t});document.dispatchEvent(e)}}}
